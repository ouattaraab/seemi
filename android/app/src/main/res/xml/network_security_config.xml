<?xml version="1.0" encoding="utf-8"?>
<!--
    Configuration de sécurité réseau Android — HIGH-08.

    Base (release / production) :
    - HTTPS uniquement (cleartextTrafficPermitted="false")
    - Seules les AC SYSTÈME sont de confiance — les AC installées par l'utilisateur
      (ex : proxies MITM comme Charles, Burp Suite) ne sont PAS acceptées.
    - Cette config couvre Android 4.2+ ; sur API 24+, les AC utilisateur sont déjà
      exclues par défaut, mais la déclaration explicite protège aussi les versions antérieures.

    Exception développement (10.0.2.2 / localhost) :
    - HTTP autorisé vers l'émulateur Android pour le dev local.
    - AC utilisateur acceptées pour permettre l'inspection réseau en dev.
    - Ce bloc n'est actif qu'en debug (le manifest debug écrase le main manifest).

    Pour ajouter du certificate pinning une fois le domaine prod connu :
    <domain-config>
        <domain includeSubdomains="true">api.votredomaine.com</domain>
        <pin-set expiration="2026-12-31">
            <pin digest="SHA-256">base64_du_sha256_certificat_primaire==</pin>
            <pin digest="SHA-256">base64_du_sha256_certificat_backup==</pin>
        </pin-set>
    </domain-config>

    Documentation : https://developer.android.com/training/articles/security-config
-->
<network-security-config>

    <!-- Règle de base : HTTPS uniquement, AC système uniquement (bloque les AC utilisateur) -->
    <base-config cleartextTrafficPermitted="false">
        <trust-anchors>
            <certificates src="system"/>
        </trust-anchors>
    </base-config>

    <!-- Exception dev : HTTP autorisé vers l'émulateur Android local -->
    <domain-config cleartextTrafficPermitted="true">
        <domain includeSubdomains="false">10.0.2.2</domain>
        <domain includeSubdomains="false">localhost</domain>
        <domain includeSubdomains="false">127.0.0.1</domain>
        <trust-anchors>
            <certificates src="system"/>
            <certificates src="user"/>
        </trust-anchors>
    </domain-config>

</network-security-config>
